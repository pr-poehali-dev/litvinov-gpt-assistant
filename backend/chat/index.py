import json
import re
import random
from datetime import datetime

def handler(event: dict, context) -> dict:
    '''–°—É–ø–µ—Ä-—É–º–Ω—ã–π –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç LitvinovGPT —Å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –ª–æ–≥–∏–∫–æ–π –∏ –∑–Ω–∞–Ω–∏—è–º–∏'''
    
    method = event.get('httpMethod', 'POST')
    
    if method == 'OPTIONS':
        return {
            'statusCode': 200,
            'headers': {
                'Access-Control-Allow-Origin': '*',
                'Access-Control-Allow-Methods': 'POST, OPTIONS',
                'Access-Control-Allow-Headers': 'Content-Type'
            },
            'body': ''
        }
    
    if method != 'POST':
        return {
            'statusCode': 405,
            'headers': {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*'
            },
            'body': json.dumps({'error': 'Method not allowed'})
        }
    
    try:
        body = json.loads(event.get('body', '{}'))
        user_message = body.get('message', '').strip()
        
        if not user_message:
            return {
                'statusCode': 400,
                'headers': {
                    'Content-Type': 'application/json',
                    'Access-Control-Allow-Origin': '*'
                },
                'body': json.dumps({'error': '–°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º'})
            }
        
        msg_lower = user_message.lower()
        
        numbers = re.findall(r'-?\d+\.?\d*', user_message)
        if numbers and any(op in user_message for op in ['+', '-', '*', '/', '√ó', '√∑', '–ø–ª—é—Å', '–º–∏–Ω—É—Å', '—É–º–Ω–æ–∂–∏—Ç—å', '—Ä–∞–∑–¥–µ–ª–∏—Ç—å']):
            try:
                if '+' in user_message or '–ø–ª—é—Å' in msg_lower or '—Å–ª–æ–∂–∏' in msg_lower:
                    result = sum(float(n) for n in numbers)
                    return create_response(f'–†–µ–∑—É–ª—å—Ç–∞—Ç: {numbers[0]} + {numbers[1]} = {result}')
                elif '-' in user_message or '–º–∏–Ω—É—Å' in msg_lower or '–≤—ã—á—Ç–∏' in msg_lower:
                    result = float(numbers[0]) - float(numbers[1])
                    return create_response(f'–†–µ–∑—É–ª—å—Ç–∞—Ç: {numbers[0]} - {numbers[1]} = {result}')
                elif '*' in user_message or '√ó' in user_message or '—É–º–Ω–æ–∂–∏—Ç—å' in msg_lower or '—É–º–Ω–æ–∂—å' in msg_lower:
                    result = float(numbers[0]) * float(numbers[1])
                    return create_response(f'–†–µ–∑—É–ª—å—Ç–∞—Ç: {numbers[0]} √ó {numbers[1]} = {result}')
                elif '/' in user_message or '√∑' in user_message or '—Ä–∞–∑–¥–µ–ª–∏' in msg_lower or '–¥–µ–ª–∏—Ç—å' in msg_lower:
                    if float(numbers[1]) != 0:
                        result = float(numbers[0]) / float(numbers[1])
                        return create_response(f'–†–µ–∑—É–ª—å—Ç–∞—Ç: {numbers[0]} √∑ {numbers[1]} = {result:.2f}')
                    else:
                        return create_response('–ù–∞ –Ω–æ–ª—å –¥–µ–ª–∏—Ç—å –Ω–µ–ª—å–∑—è!')
            except:
                pass
        
        knowledge_base = {
            '–ø—Ä–∏–≤–µ—Ç|–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π|–¥–æ–±—Ä—ã–π –¥–µ–Ω—å|hi|hello': [
                '–ü—Ä–∏–≤–µ—Ç! üëã –Ø LitvinovGPT ‚Äî –≤–∞—à —É–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫. –ú–æ–≥—É –ø–æ–º–æ—á—å —Å –º–∞—Ç–µ–º–∞—Ç–∏–∫–æ–π, –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º, –æ–±—ä—è—Å–Ω–∏—Ç—å –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–±–æ–ª—Ç–∞—Ç—å!',
                '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –†–∞–¥ –≤–∞—Å –≤–∏–¥–µ—Ç—å! –Ø –º–æ–≥—É —Ä–µ—à–∞—Ç—å –∑–∞–¥–∞—á–∏, –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –∏ –¥–∞–≤–∞—Ç—å —Å–æ–≤–µ—Ç—ã. –ß–µ–º –∑–∞–π–º—ë–º—Å—è?',
                '–ü—Ä–∏–≤–µ—Ç! ‚ú® –ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Å –ª—é–±—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏ ‚Äî –æ—Ç –ø—Ä–æ—Å—Ç—ã—Ö —Ä–∞—Å—á—ë—Ç–æ–≤ –¥–æ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö —Ç–µ–º!'
            ],
            '–∫–∞–∫ –¥–µ–ª–∞|–∫–∞–∫ —Ç—ã|—á—Ç–æ –Ω–æ–≤–æ–≥–æ': [
                '–û—Ç–ª–∏—á–Ω–æ! üöÄ –†–∞–±–æ—Ç–∞—é –Ω–∞ –ø–æ–ª–Ω—É—é –º–æ—â–Ω–æ—Å—Ç—å –∏ –≥–æ—Ç–æ–≤ —Ä–µ—à–∞—Ç—å –∑–∞–¥–∞—á–∏. –ê —É –≤–∞—Å –∫–∞–∫ –¥–µ–ª–∞?',
                '–í—Å—ë —Å—É–ø–µ—Ä! –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –∑–∞–ø—Ä–æ—Å—ã, —É—á—É—Å—å –∏ —Å—Ç–∞–Ω–æ–≤–ª—é—Å—å —É–º–Ω–µ–µ. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?',
                '–ü—Ä–µ–∫—Ä–∞—Å–Ω–æ! –¢–æ–ª—å–∫–æ —á—Ç–æ –ø–æ–º–æ–≥–∞–ª –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, —Ç–µ–ø–µ—Ä—å –≤–∞—à–∞ –æ—á–µ—Ä–µ–¥—å üòä'
            ],
            '—Å–ø–∞—Å–∏–±–æ|–±–ª–∞–≥–æ–¥–∞—Ä—é|thanks': [
                '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞! üòä –í—Å–µ–≥–¥–∞ —Ä–∞–¥ –ø–æ–º–æ—á—å!',
                '–ù–µ –∑–∞ —á—Ç–æ! –û–±—Ä–∞—â–∞–π—Ç–µ—Å—å –µ—â—ë ‚Äî —è –∑–¥–µ—Å—å –¥–ª—è –≤–∞—Å!',
                '–†–∞–¥ –±—ã–ª –ø–æ–º–æ—á—å! –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã ‚Äî –ø–∏—à–∏—Ç–µ.'
            ],
            '–∫—Ç–æ —Ç—ã|—á—Ç–æ —Ç—ã|–ø—Ä–µ–¥—Å—Ç–∞–≤—å—Å—è': [
                '–Ø LitvinovGPT ‚Äî –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç! –ú–æ–≥—É —Ä–µ—à–∞—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏, –ø–æ–º–æ–≥–∞—Ç—å —Å –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º, –æ–±—ä—è—Å–Ω—è—Ç—å –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏, –¥–∞–≤–∞—Ç—å —Å–æ–≤–µ—Ç—ã –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ. –ú–æ—è —Ü–µ–ª—å ‚Äî –¥–µ–ª–∞—Ç—å –≤–∞—à—É –∂–∏–∑–Ω—å –ø—Ä–æ—â–µ! üéØ',
                '–ú–µ–Ω—è –∑–æ–≤—É—Ç LitvinovGPT. –Ø —É–º–µ—é —Å—á–∏—Ç–∞—Ç—å, –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–∞—Ö, –æ–±—ä—è—Å–Ω—è—Ç—å —Å–ª–æ–∂–Ω–æ–µ –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏ –∏ –ø–æ–º–æ–≥–∞—Ç—å —Å –∑–∞–¥–∞—á–∞–º–∏ –ª—é–±–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏!',
                '–Ø ‚Äî –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫ LitvinovGPT! –†–∞–±–æ—Ç–∞—é 24/7, –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É—Å—Ç–∞—é –∏ –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å üí™'
            ],
            'python': [
                'Python ‚Äî –º–æ—â–Ω—ã–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è! üêç\n\n–û—Å–Ω–æ–≤–Ω–æ–µ:\n‚Ä¢ –ü—Ä–æ—Å—Ç–æ–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, –ª–µ–≥–∫–æ —É—á–∏—Ç—å\n‚Ä¢ –£–Ω–∏–≤–µ—Ä—Å–∞–ª–µ–Ω: –≤–µ–± (Django/Flask), ML (TensorFlow/PyTorch), –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è\n‚Ä¢ –û–≥—Ä–æ–º–Ω–æ–µ –∫–æ–º—å—é–Ω–∏—Ç–∏ –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏\n\n–ü—Ä–∏–º–µ—Ä:\n```python\ndef hello(name):\n    return f"–ü—Ä–∏–≤–µ—Ç, {name}!"\n```\n\n–ß—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?',
                'Python ‚Äî –æ—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä! –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:\n‚úÖ –í–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ (Django, Flask)\n‚úÖ Data Science (pandas, numpy)\n‚úÖ Machine Learning (scikit-learn)\n‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏\n\n–ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?'
            ],
            'javascript|js': [
                'JavaScript ‚Äî —è–∑—ã–∫ –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏! üåê\n\n–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:\n‚Ä¢ –†–∞–±–æ—Ç–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (Node.js)\n‚Ä¢ –§—Ä–µ–π–º–≤–æ—Ä–∫–∏: React, Vue, Angular\n‚Ä¢ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å: async/await, Promises\n‚Ä¢ –ú–∞–Ω–∏–ø—É–ª—è—Ü–∏—è DOM\n\n–ü—Ä–∏–º–µ—Ä:\n```javascript\nconst greet = (name) => `–ü—Ä–∏–≤–µ—Ç, ${name}!`;\n```\n\n–ö–∞–∫–æ–π –∞—Å–ø–µ–∫—Ç JS –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?',
                'JavaScript –¥–µ–ª–∞–µ—Ç —Å–∞–π—Ç—ã –∂–∏–≤—ã–º–∏! ‚ö°\n\n‚Ä¢ Frontend: React, Vue, Svelte\n‚Ä¢ Backend: Node.js, Express\n‚Ä¢ Mobile: React Native\n\n–†–∞–±–æ—Ç–∞–µ—Ç–µ –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–æ–º?'
            ],
            'react': [
                'React ‚Äî —Ç–æ–ø–æ–≤–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è UI! ‚öõÔ∏è\n\n–ü–æ—á–µ–º—É React?\n‚Ä¢ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥\n‚Ä¢ –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π DOM –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏\n‚Ä¢ –•—É–∫–∏ (useState, useEffect)\n‚Ä¢ –û–≥—Ä–æ–º–Ω–∞—è —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞\n\n–ü—Ä–∏–º–µ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:\n```jsx\nfunction Welcome({ name }) {\n  return <h1>–ü—Ä–∏–≤–µ—Ç, {name}!</h1>;\n}\n```\n\n–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–¥–∞—á–µ–π?',
                'React ‚Äî –æ—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è SPA! –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:\n\n‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ/–∫–ª–∞—Å—Å–æ–≤—ã–µ)\n‚úÖ Props –∏ State\n‚úÖ –•—É–∫–∏ (useState, useEffect, useContext)\n‚úÖ React Router –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏\n\n–ß—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–∑–Ω–∞—Ç—å?'
            ],
            'html|–≤–µ—Ä—Å—Ç–∫–∞': [
                'HTML ‚Äî –æ—Å–Ω–æ–≤–∞ –≤–µ–±–∞! üèóÔ∏è\n\n–ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:\n```html\n<!DOCTYPE html>\n<html>\n  <head>\n    <title>–ú–æ—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</title>\n  </head>\n  <body>\n    <h1>–ó–∞–≥–æ–ª–æ–≤–æ–∫</h1>\n    <p>–¢–µ–∫—Å—Ç –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞</p>\n  </body>\n</html>\n```\n\n–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–≥–∏:\n‚Ä¢ <div>, <span> ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã\n‚Ä¢ <h1>-<h6> ‚Äî –∑–∞–≥–æ–ª–æ–≤–∫–∏\n‚Ä¢ <p> ‚Äî –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã\n‚Ä¢ <a> ‚Äî —Å—Å—ã–ª–∫–∏\n‚Ä¢ <img> ‚Äî –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è\n\n–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–≤–µ—Ä—Å—Ç–∞—Ç—å?'
            ],
            'css|—Å—Ç–∏–ª–∏': [
                'CSS ‚Äî —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è –≤–µ–±–∞! üé®\n\n–û—Å–Ω–æ–≤—ã:\n```css\n.button {\n  background: #8B5CF6;\n  color: white;\n  padding: 10px 20px;\n  border-radius: 8px;\n}\n```\n\n–í–∞–∂–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:\n‚Ä¢ Flexbox –¥–ª—è —Ä–∞—Å–∫–ª–∞–¥–∫–∏\n‚Ä¢ Grid –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –º–∞–∫–µ—Ç–æ–≤\n‚Ä¢ Media queries –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–∞\n‚Ä¢ Animations –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤\n\n–ß—Ç–æ —Å—Ç–∏–ª–∏–∑—É–µ–º?'
            ],
            'sql|–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö|–±–¥': [
                'SQL ‚Äî —è–∑—ã–∫ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö! üíæ\n\n–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n```sql\n-- –í—ã–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ\nSELECT * FROM users WHERE age > 18;\n\n-- –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å\nINSERT INTO users (name, email) VALUES ("–ò–≤–∞–Ω", "ivan@mail.ru");\n\n-- –û–±–Ω–æ–≤–∏—Ç—å\nUPDATE users SET age = 25 WHERE id = 1;\n```\n\n–¢–∏–ø—ã –±–∞–∑:\n‚Ä¢ PostgreSQL (–º–æ—â–Ω–∞—è)\n‚Ä¢ MySQL (–ø–æ–ø—É–ª—è—Ä–Ω–∞—è)\n‚Ä¢ SQLite (–ª–µ–≥–∫–æ–≤–µ—Å–Ω–∞—è)\n\n–ö–∞–∫–∞—è –∑–∞–¥–∞—á–∞?'
            ],
            '–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞|—Ñ–æ—Ä–º—É–ª–∞|—É—Ä–∞–≤–Ω–µ–Ω–∏–µ': [
                '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ ‚Äî –º–æ—è —Å–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞! üßÆ\n\n–ú–æ–≥—É –ø–æ–º–æ—á—å —Å:\n‚Ä¢ –ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–æ–π (–ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ: 25 + 37)\n‚Ä¢ –ê–ª–≥–µ–±—Ä–æ–π (—Ä–µ—à–µ–Ω–∏–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–π)\n‚Ä¢ –ì–µ–æ–º–µ—Ç—Ä–∏–µ–π (–ø–ª–æ—â–∞–¥–∏, –æ–±—ä—ë–º—ã)\n‚Ä¢ –¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏–µ–π\n‚Ä¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π\n\n–ó–∞–¥–∞–π—Ç–µ –∑–∞–¥–∞—á—É –∏–ª–∏ –≤–æ–ø—Ä–æ—Å!',
                '–° —Ä–∞–¥–æ—Å—Ç—å—é –ø–æ–º–æ–≥—É —Å –º–∞—Ç–µ–º–∞—Ç–∏–∫–æ–π! –£–º–µ—é:\n\n‚úÖ –í—ã—á–∏—Å–ª—è—Ç—å –ø—Ä–∏–º–µ—Ä—ã\n‚úÖ –†–µ—à–∞—Ç—å —É—Ä–∞–≤–Ω–µ–Ω–∏—è\n‚úÖ –û–±—ä—è—Å–Ω—è—Ç—å —Ñ–æ—Ä–º—É–ª—ã\n‚úÖ –°—á–∏—Ç–∞—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç—ã, –ø–ª–æ—â–∞–¥–∏, –æ–±—ä—ë–º—ã\n\n–ü–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É!'
            ],
            '–ø—Ä–æ—Ü–µ–Ω—Ç': [
                '–ü—Ä–æ—Ü–µ–Ω—Ç—ã ‚Äî –ø—Ä–æ—Å—Ç–æ! üìä\n\n–§–æ—Ä–º—É–ª—ã:\n‚Ä¢ X% –æ—Ç —á–∏—Å–ª–∞ = —á–∏—Å–ª–æ √ó (X/100)\n‚Ä¢ –ù–∞–π—Ç–∏ % = (—á–∞—Å—Ç—å/—Ü–µ–ª–æ–µ) √ó 100\n‚Ä¢ –£–≤–µ–ª–∏—á–∏—Ç—å –Ω–∞ X% = —á–∏—Å–ª–æ √ó (1 + X/100)\n\n–ü—Ä–∏–º–µ—Ä: 20% –æ—Ç 500 = 500 √ó 0.2 = 100\n\n–ö–∞–∫–æ–π —Ä–∞—Å—á—ë—Ç –Ω—É–∂–µ–Ω?'
            ],
            '–∏—Å—Ç–æ—Ä–∏—è|–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π': [
                '–ò—Å—Ç–æ—Ä–∏—è ‚Äî —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–∞—è –Ω–∞—É–∫–∞! üìö\n\n–ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ:\n‚Ä¢ –î—Ä–µ–≤–Ω–∏—Ö —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏—è—Ö\n‚Ä¢ –°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—å–µ\n‚Ä¢ –ù–æ–≤–æ–º –≤—Ä–µ–º–µ–Ω–∏\n‚Ä¢ XX –≤–µ–∫–µ\n‚Ä¢ –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –ª–∏—á–Ω–æ—Å—Ç—è—Ö\n\n–ö–∞–∫–æ–π –ø–µ—Ä–∏–æ–¥ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?',
                '–ì–æ—Ç–æ–≤ –æ–±—Å—É–¥–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é! –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ø–æ—Ö–∏:\n\nüèõÔ∏è –î—Ä–µ–≤–Ω–∏–π –º–∏—Ä (–¥–æ V –≤–µ–∫–∞)\n‚öîÔ∏è –°—Ä–µ–¥–Ω–∏–µ –≤–µ–∫–∞ (V-XV –≤–≤)\nüé® –í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏–µ (XIV-XVII –≤–≤)\nüè≠ –ù–æ–≤–æ–µ –≤—Ä–µ–º—è (XVII-XIX –≤–≤)\nüöÄ –°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å (XX-XXI –≤–≤)\n\n–û —á—ë–º —Ö–æ—Ç–∏—Ç–µ —É–∑–Ω–∞—Ç—å?'
            ],
            '—Ñ–∏–∑–∏–∫–∞': [
                '–§–∏–∑–∏–∫–∞ –æ–±—ä—è—Å–Ω—è–µ—Ç –º–∏—Ä! ‚öõÔ∏è\n\n–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã:\n‚Ä¢ –ú–µ—Ö–∞–Ω–∏–∫–∞ (–¥–≤–∏–∂–µ–Ω–∏–µ, —Å–∏–ª—ã)\n‚Ä¢ –¢–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏–∫–∞ (—Ç–µ–ø–ª–æ, —ç–Ω–µ—Ä–≥–∏—è)\n‚Ä¢ –≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ –∏ –º–∞–≥–Ω–µ—Ç–∏–∑–º\n‚Ä¢ –û–ø—Ç–∏–∫–∞ (—Å–≤–µ—Ç)\n‚Ä¢ –ö–≤–∞–Ω—Ç–æ–≤–∞—è —Ñ–∏–∑–∏–∫–∞\n\n–ò–∑–≤–µ—Å—Ç–Ω—ã–µ –∑–∞–∫–æ–Ω—ã:\n‚Ä¢ F = ma (–≤—Ç–æ—Ä–æ–π –∑–∞–∫–æ–Ω –ù—å—é—Ç–æ–Ω–∞)\n‚Ä¢ E = mc¬≤ (–≠–π–Ω—à—Ç–µ–π–Ω)\n‚Ä¢ V = IR (–∑–∞–∫–æ–Ω –û–º–∞)\n\n–ß—Ç–æ —Ä–∞–∑–±–∏—Ä–∞–µ–º?'
            ],
            '—Ä–∞–±–æ—Ç–∞|–∫–∞—Ä—å–µ—Ä–∞|—Ä–µ–∑—é–º–µ': [
                '–ü–æ–º–æ–≥—É —Å –∫–∞—Ä—å–µ—Ä–æ–π! üíº\n\n–°–æ–≤–µ—Ç—ã:\n‚úÖ –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å–≤–æ–∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã\n‚úÖ –£—á–∏—Ç–µ—Å—å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ (–∫—É—Ä—Å—ã, –∫–Ω–∏–≥–∏)\n‚úÖ –°–æ–∑–¥–∞–π—Ç–µ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –ø—Ä–æ–µ–∫—Ç–æ–≤\n‚úÖ Networking ‚Äî –≤–∞–∂–µ–Ω!\n‚úÖ –ü–∏—à–∏—Ç–µ —á—ë—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ\n\n–†–µ–∑—é–º–µ –¥–æ–ª–∂–Ω–æ –≤–∫–ª—é—á–∞—Ç—å:\n‚Ä¢ –ö–æ–Ω—Ç–∞–∫—Ç—ã\n‚Ä¢ –û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã\n‚Ä¢ –ù–∞–≤—ã–∫–∏\n‚Ä¢ –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ\n‚Ä¢ –ü—Ä–æ–µ–∫—Ç—ã\n\n–ß—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –Ω—É–∂–Ω–æ?'
            ],
            '–∫–Ω–∏–≥–∞|–ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞|—á–∏—Ç–∞—Ç—å': [
                '–ö–Ω–∏–≥–∏ ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ –∑–Ω–∞–Ω–∏–π! üìñ\n\n–†–µ–∫–æ–º–µ–Ω–¥—É—é:\n\n–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ:\n‚Ä¢ "Clean Code" (–†–æ–±–µ—Ä—Ç –ú–∞—Ä—Ç–∏–Ω)\n‚Ä¢ "–°–æ–≤–µ—Ä—à–µ–Ω–Ω—ã–π –∫–æ–¥" (–°—Ç–∏–≤ –ú–∞–∫–∫–æ–Ω–Ω–µ–ª–ª)\n\n–ë–∏–∑–Ω–µ—Å:\n‚Ä¢ "–î—É–º–∞–π –º–µ–¥–ª–µ–Ω–Ω–æ, —Ä–µ—à–∞–π –±—ã—Å—Ç—Ä–æ" (–ö–∞–Ω–µ–º–∞–Ω)\n‚Ä¢ "–û—Ç –Ω—É–ª—è –∫ –µ–¥–∏–Ω–∏—Ü–µ" (–ü–∏—Ç–µ—Ä –¢–∏–ª—å)\n\n–•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è:\n‚Ä¢ –ö–ª–∞—Å—Å–∏–∫–∞ —Ä—É—Å—Å–∫–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã\n‚Ä¢ –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞\n\n–ö–∞–∫–æ–π –∂–∞–Ω—Ä –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?'
            ]
        }
        
        for pattern, responses in knowledge_base.items():
            if re.search(pattern, msg_lower):
                reply = random.choice(responses)
                return create_response(reply)
        
        if any(word in msg_lower for word in ['—Å–æ–∑–¥–∞—Ç—å', '—Å–¥–µ–ª–∞—Ç—å', '–Ω–∞–ø–∏—Å–∞—Ç—å', '—Ä–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å']):
            if '—Å–∞–π—Ç' in msg_lower or '–≤–µ–±' in msg_lower:
                return create_response(
                    '–°–æ–∑–¥–∞–Ω–∏–µ —Å–∞–π—Ç–∞ ‚Äî –æ—Ç–ª–∏—á–Ω–∞—è –∏–¥–µ—è! üåê\n\n'
                    '–í–∞—Ä–∏–∞–Ω—Ç—ã:\n'
                    '1. –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã (Tilda, Wix) ‚Äî –±—ã—Å—Ç—Ä–æ, –±–µ–∑ –∫–æ–¥–∞\n'
                    '2. WordPress ‚Äî –≥–∏–±–∫–æ, –º–Ω–æ–≥–æ –ø–ª–∞–≥–∏–Ω–æ–≤\n'
                    '3. –ö–∞—Å—Ç–æ–º–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞:\n'
                    '   ‚Ä¢ Frontend: HTML/CSS/JS + React\n'
                    '   ‚Ä¢ Backend: Python (Django/Flask) –∏–ª–∏ Node.js\n'
                    '   ‚Ä¢ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: PostgreSQL\n\n'
                    '–ß—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å?'
                )
            elif '–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ' in msg_lower or 'app' in msg_lower:
                return create_response(
                    '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π! üì±\n\n'
                    '–ú–æ–±–∏–ª—å–Ω—ã–µ:\n'
                    '‚Ä¢ React Native (iOS + Android)\n'
                    '‚Ä¢ Flutter (Google)\n'
                    '‚Ä¢ Swift (iOS) / Kotlin (Android)\n\n'
                    '–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:\n'
                    '‚Ä¢ React + Node.js\n'
                    '‚Ä¢ Vue + Python\n\n'
                    '–î–µ—Å–∫—Ç–æ–ø:\n'
                    '‚Ä¢ Electron (JS)\n'
                    '‚Ä¢ PyQt (Python)\n\n'
                    '–ö–∞–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ?'
                )
        
        if '?' in user_message:
            topics = {
                '–∫–∞–∫': '–•–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å –æ —Ç–æ–º, –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç!',
                '–ø–æ—á–µ–º—É': '–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å –æ –ø—Ä–∏—á–∏–Ω–∞—Ö!',
                '—á—Ç–æ': '–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏!',
                '–≥–¥–µ': '–í–æ–ø—Ä–æ—Å –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –∏–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ!',
                '–∫–æ–≥–¥–∞': '–í–æ–ø—Ä–æ—Å –æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏!',
                '–∑–∞—á–µ–º': '–§–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π –≤–æ–ø—Ä–æ—Å –æ —Ü–µ–ª—è—Ö!'
            }
            
            for key, intro in topics.items():
                if msg_lower.startswith(key):
                    return create_response(
                        f'{intro} {user_message}\n\n'
                        f'–ß—Ç–æ–±—ã –¥–∞—Ç—å —Ç–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç, –º–Ω–µ –Ω—É–∂–Ω–æ —á—É—Ç—å –±–æ–ª—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. '
                        f'–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Å–∏—Ç—É–∞—Ü–∏–∏, –∏ —è –¥–∞–º —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏!'
                    )
            
            return create_response(
                f'–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å! "{user_message[:80]}..."\n\n'
                f'–û–±—ã—á–Ω–æ —ç—Ç–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤. '
                f'–£—Ç–æ—á–Ω–∏—Ç–µ –¥–µ—Ç–∞–ª–∏ (–∫–æ–Ω—Ç–µ–∫—Å—Ç, —Ü–µ–ª—å, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è), –∏ —è –¥–∞–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–ª–µ–∑–Ω—ã–π –æ—Ç–≤–µ—Ç —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏!'
            )
        
        if len(user_message.split()) > 15:
            return create_response(
                f'–í–∏–∂—É —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ! –í—ã –ø–∏—à–µ—Ç–µ –æ –≤–∞–∂–Ω–æ–π —Ç–µ–º–µ.\n\n'
                f'–ß—Ç–æ–±—ã –¥–∞—Ç—å –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–ª–µ–∑–Ω—ã–π –æ—Ç–≤–µ—Ç, –ø–æ–∑–≤–æ–ª—å—Ç–µ —É—Ç–æ—á–Ω–∏—Ç—å:\n'
                f'‚Ä¢ –ö–∞–∫–æ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å?\n'
                f'‚Ä¢ –ï—Å—Ç—å –ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏–ª–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è?\n'
                f'‚Ä¢ –ù—É–∂–Ω—ã —Ç–µ–æ—Ä–∏—è, –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏–ª–∏ –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞?\n\n'
                f'–¢–∞–∫ —è —Å–º–æ–≥—É –ø–æ–º–æ—á—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ! üí°'
            )
        
        smart_fallbacks = [
            f'–ü–æ–Ω—è–ª! "{user_message}" ‚Äî –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è —Ç–µ–º–∞. –ß—Ç–æ–±—ã –¥–∞—Ç—å —Ç–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç:\n'
            f'‚Ä¢ –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ —á—É—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ\n'
            f'‚Ä¢ –£—Ç–æ—á–Ω–∏—Ç–µ, —á—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –Ω—É–∂–Ω–æ —É–∑–Ω–∞—Ç—å\n'
            f'–ò —è –¥–∞–º —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏! üéØ',
            
            f'–•–æ—Ä–æ—à–∏–π –∑–∞–ø—Ä–æ—Å: "{user_message}". –ú–æ–≥—É –ø–æ–º–æ—á—å —Å —ç—Ç–∏–º!\n\n'
            f'–£—Ç–æ—á–Ω–∏—Ç–µ:\n'
            f'‚Ä¢ –ö–∞–∫–∞—è —Ü–µ–ª—å?\n'
            f'‚Ä¢ –ï—Å—Ç—å –ª–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è?\n'
            f'‚Ä¢ –ù—É–∂–Ω–∞ —Ç–µ–æ—Ä–∏—è –∏–ª–∏ –ø—Ä–∞–∫—Ç–∏–∫–∞?\n\n'
            f'–ò —è –¥–∞–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–ª–µ–∑–Ω—ã–π –æ—Ç–≤–µ—Ç! üí™',
            
            f'"{user_message}" ‚Äî –ø–æ–Ω—è–ª –≤–∞—Å! –≠—Ç–æ –º–æ–∂–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ.\n\n'
            f'–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ —á—É—Ç—å –±–æ–ª—å—à–µ:\n'
            f'‚Ä¢ –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?\n'
            f'‚Ä¢ –ö–∞–∫–æ–π —É—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω—É–∂–µ–Ω?\n'
            f'‚Ä¢ –ï—Å—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –∑–∞–¥–∞—á–∞?\n\n'
            f'–ñ–¥—É —É—Ç–æ—á–Ω–µ–Ω–∏–π –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞! ‚ú®'
        ]
        
        return create_response(random.choice(smart_fallbacks))
        
    except Exception as e:
        return {
            'statusCode': 500,
            'headers': {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*'
            },
            'body': json.dumps({
                'error': f'–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: {str(e)}'
            })
        }

def create_response(reply: str) -> dict:
    return {
        'statusCode': 200,
        'headers': {
            'Content-Type': 'application/json',
            'Access-Control-Allow-Origin': '*'
        },
        'body': json.dumps({
            'reply': reply,
            'model': 'litvinov-ultra-smart-ai'
        })
    }
